#===================================================================================
CXX             = g++
OBJ_PATH        = ./obj
SRC_PATH        = ./src
LINKER_NAME	= libpluginExample_2.so
LIB_SONAME	= $(LINKER_NAME).1
LIB_FILENAME	= $(LIB_SONAME).0.0 
LIB_PATH        = 
INCLUDE_PATH    = ./include 
LIB             = 
CXXFLAGS        = -Wall $(INCLUDE_PATH:%=-I%) -g -fPIC -D__DEBUG_MODE__ -O3 #-D__USE_PCIE_FAKE_DEV__
#===================================================================================

VPATH = $(SRC_PATH):$(OBJ_PATH):$(INCLUDE_PATH)
#ALL =   $(wildcard $(SRC_PATH)/*.cpp)
ALL =   $(SRC_PATH)/pluginExample_2.cpp $(SRC_PATH)/pluginBase.cpp
OBJ =   $(ALL:$(SRC_PATH)/%.cpp=%.o)
DEP =   $(ALL:$(SRC_PATH)/%.cpp=%.d) 


%.o : %.cpp
	$(CXX) -c $(CXXFLAGS) $< -o $(OBJ_PATH)/$@

$(LIB_FILENAME) :    $(OBJ)
	$(CC) -shared -Wl,-soname,$(LIB_SONAME) -o $@ $(OBJ:%.o=$(OBJ_PATH)/%.o) $(CXXFLAGS)
	cp $(LIB_FILENAME) ../plugins
	cp ./include/* ../plugins/include
	ldconfig -n ../plugins	
	-ln -sf $(LIB_FILENAME) ../plugins/$(LINKER_NAME)

$(DEP): %.d : %.cpp
	@$(CXX) -MM $< $(CXXFLAGS) > $@  
	@cp $@ $@.tmp
	@sed -e s/\\.o/\\.d/ < $@.tmp >> $@
	@rm $@.tmp

-include $(DEP)
	
clean:
	-rm -f  $(DEP)
	-rm -f  $(OBJ_PATH)/*
	-rm -f  $(LIB_FILENAME)
	

.PHONY :  clean libtest
